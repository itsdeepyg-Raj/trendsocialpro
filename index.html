<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TrendSocial Pro</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- React & Babel -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Firebase App (Compat Version for maximum stability in single HTML files) -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

    <style>
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        body { background-color: #09090b; color: white; font-family: sans-serif; margin: 0; }
        [data-lucide] { display: inline-block; vertical-align: middle; }
        input::placeholder { color: #52525b; }
        .animate-in { animation: fadeIn 0.5s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // --- 1. FIREBASE INITIALIZATION ---
        const firebaseConfig = {
            apiKey: "AIzaSyCP7HsmoQyMeenWxhTAcgBoRs-6ErtzhJs",
            authDomain: "trend-social-88546.firebaseapp.com",
            projectId: "trend-social-88546",
            storageBucket: "trend-social-88546.firebasestorage.app",
            messagingSenderId: "859903608854",
            appId: "1:859903608854:web:82b46edf364994f7cbcd37"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        const appId = 'trend-social-v1-production';

        const { useState, useEffect, useRef } = React;

        // Icon Helper for Lucide
        const Icon = ({ name, size = 24, className = "" }) => {
            useEffect(() => { if (window.lucide) window.lucide.createIcons(); }, [name]);
            return <i data-lucide={name} className={className} style={{ width: size, height: size }}></i>;
        };

        const App = () => {
            const [user, setUser] = useState(null);
            const [authMode, setAuthMode] = useState('login');
            const [appMode, setAppMode] = useState('selector');
            const [activeTab, setActiveTab] = useState('feed');
            const [adminTab, setAdminTab] = useState('sellers');
            
            const [sellerProfile, setSellerProfile] = useState(null);
            const [myProfile, setMyProfile] = useState(null);
            const [products, setProducts] = useState([]);
            const [allSellers, setAllSellers] = useState([]);
            const [allProfiles, setAllProfiles] = useState([]);
            const [allMessages, setAllMessages] = useState([]);
            const [isLoading, setIsLoading] = useState(true);
            const [activeChatId, setActiveChatId] = useState(null);

            useEffect(() => {
                const unsub = auth.onAuthStateChanged(u => {
                    setUser(u);
                    if (!u) setIsLoading(false);
                });
                return () => unsub();
            }, []);

            useEffect(() => {
                if (!user) return;

                // Sync My Profile
                db.collection('artifacts').doc(appId).collection('public').doc('data').collection('profiles').doc(user.uid)
                    .onSnapshot(snap => {
                        if (snap.exists) setMyProfile(snap.data());
                        else db.collection('artifacts').doc(appId).collection('public').doc('data').collection('profiles').doc(user.uid).set({
                            uid: user.uid, name: user.email.split('@')[0], role: 'user', joinedAt: new Date().toISOString()
                        });
                    });

                // Sync Global Data
                db.collection('artifacts').doc(appId).collection('public').doc('data').collection('products').onSnapshot(s => setProducts(s.docs.map(d => ({id: d.id, ...d.data()}))));
                db.collection('artifacts').doc(appId).collection('public').doc('data').collection('sellers').onSnapshot(s => setAllSellers(s.docs.map(d => ({id: d.id, ...d.data()}))));
                db.collection('artifacts').doc(appId).collection('public').doc('data').collection('profiles').onSnapshot(s => setAllProfiles(s.docs.map(d => ({id: d.id, ...d.data()}))));
                db.collection('artifacts').doc(appId).collection('public').doc('data').collection('messages').onSnapshot(s => setAllMessages(s.docs.map(d => ({id: d.id, ...d.data()}))));
                db.collection('artifacts').doc(appId).collection('public').doc('data').collection('sellers').doc(user.uid).onSnapshot(s => setSellerProfile(s.exists ? s.data() : null));

                setIsLoading(false);
            }, [user]);

            const handleAuth = async (e) => {
                e.preventDefault();
                const email = e.target.email.value;
                const pass = e.target.pass.value;
                try {
                    if (authMode === 'signup') await auth.createUserWithEmailAndPassword(email, pass);
                    else await auth.signInWithEmailAndPassword(email, pass);
                } catch (err) { alert(err.message); }
            };

            const sendMessage = async (text, receiverId, receiverName) => {
                if (!text.trim()) return;
                await db.collection('artifacts').doc(appId).collection('public').doc('data').collection('messages').add({
                    senderId: user.uid, senderName: myProfile?.name || "User", receiverId, receiverName, text, timestamp: new Date().toISOString()
                });
            };

            const ChatWindow = ({ targetId, targetName, onClose }) => {
                const [msg, setMsg] = useState("");
                const chatMsgs = allMessages.filter(m => (m.senderId === user.uid && m.receiverId === targetId) || (m.senderId === targetId && m.receiverId === user.uid)).sort((a,b) => new Date(a.timestamp) - new Date(b.timestamp));
                return (
                    <div className="fixed inset-0 z-[100] bg-white flex flex-col text-black animate-in">
                        <header className="p-4 border-b flex items-center justify-between">
                            <button onClick={onClose} className="p-2"><Icon name="arrow-left"/></button>
                            <p className="font-bold">@{targetName}</p>
                            <div className="w-10"></div>
                        </header>
                        <div className="flex-1 overflow-y-auto p-4 space-y-2">
                            {chatMsgs.map(m => (
                                <div key={m.id} className={`flex ${m.senderId === user.uid ? 'justify-end' : 'justify-start'}`}>
                                    <div className={`p-3 rounded-2xl max-w-[80%] ${m.senderId === user.uid ? 'bg-zinc-900 text-white' : 'bg-zinc-100 text-zinc-800'}`}>{m.text}</div>
                                </div>
                            ))}
                        </div>
                        <div className="p-4 border-t flex gap-2">
                            <input value={msg} onChange={e => setMsg(e.target.value)} className="flex-1 bg-zinc-100 p-3 rounded-xl outline-none" placeholder="Type a message..." />
                            <button onClick={() => { sendMessage(msg, targetId, targetName); setMsg(""); }} className="bg-zinc-900 text-white p-3 rounded-xl"><Icon name="send" size={20}/></button>
                        </div>
                    </div>
                );
            };

            if (isLoading) return <div className="h-screen flex items-center justify-center bg-zinc-950 text-emerald-500 font-black italic animate-pulse">TRENDSOCIAL...</div>;

            if (!user) {
                return (
                    <div className="h-screen flex flex-col items-center justify-center p-8 bg-zinc-950">
                        <div className="bg-emerald-500 p-5 rounded-[30px] mb-8 shadow-2xl shadow-emerald-500/20"><Icon name="shopping-bag" size={40}/></div>
                        <h1 className="text-4xl font-black italic mb-10 tracking-tighter">TrendSocial</h1>
                        <form onSubmit={handleAuth} className="w-full max-w-xs space-y-4">
                            <input name="email" type="email" required className="w-full bg-zinc-900 p-5 rounded-[24px] outline-none border border-zinc-800 focus:border-emerald-500 text-white" placeholder="Email" />
                            <input name="pass" type="password" required className="w-full bg-zinc-900 p-5 rounded-[24px] border border-zinc-800 outline-none focus:border-emerald-500 text-white" placeholder="Password" />
                            <button className="w-full bg-emerald-500 py-5 rounded-[24px] font-black uppercase text-xs tracking-widest shadow-lg active:scale-95 transition-transform">{authMode === 'login' ? 'Sign In' : 'Create Account'}</button>
                            <button type="button" onClick={() => setAuthMode(authMode === 'login' ? 'signup' : 'login')} className="w-full text-zinc-600 text-[10px] font-black uppercase tracking-widest">{authMode === 'login' ? "New here? Sign Up" : "Back to Login"}</button>
                        </form>
                    </div>
                );
            }

            if (appMode === 'selector') {
                return (
                    <div className="h-screen flex flex-col items-center justify-center p-8 text-center bg-zinc-950">
                        <h1 className="text-4xl font-black italic mb-2 tracking-tighter">TrendSocial</h1>
                        <p className="text-zinc-600 text-[10px] font-black uppercase tracking-[0.3em] mb-12">Select Workspace</p>
                        <div className="grid gap-4 w-full max-w-xs">
                            <button onClick={() => setAppMode('buyer')} className="bg-emerald-500 p-8 rounded-[40px] flex flex-col items-center gap-2 shadow-xl shadow-emerald-500/20 active:scale-95 transition-transform">
                                <Icon name="shopping-bag" size={32} />
                                <span className="font-black text-xl">The Shop</span>
                            </button>
                            <button onClick={() => setAppMode('seller')} className="bg-indigo-600 p-8 rounded-[40px] flex flex-col items-center gap-2 shadow-xl shadow-indigo-600/20 active:scale-95 transition-transform">
                                <Icon name="layout-dashboard" size={32} />
                                <span className="font-black text-xl">The Hub</span>
                            </button>
                            <button onClick={() => setAppMode('admin')} className="bg-zinc-800 p-6 rounded-[32px] flex flex-col items-center gap-1 border border-zinc-700 mt-4 text-amber-500 active:scale-95 transition-transform">
                                <Icon name="shield-alert" size={24} />
                                <span className="font-black text-[9px] uppercase text-zinc-300">Admin Control</span>
                            </button>
                            <button onClick={() => auth.signOut()} className="mt-12 text-zinc-600 font-bold text-[10px] uppercase tracking-widest">Sign Out</button>
                        </div>
                    </div>
                );
            }

            return (
                <div className="h-screen flex flex-col bg-white max-w-md mx-auto relative text-black overflow-hidden shadow-2xl">
                    <header className="p-4 border-b flex justify-between items-center bg-white sticky top-0 z-50">
                        <button onClick={() => setAppMode('selector')} className="p-2 bg-zinc-50 rounded-full"><Icon name="arrow-left" size={18}/></button>
                        <h1 className="font-black italic text-lg tracking-tight">{appMode.toUpperCase()}</h1>
                        <div className="w-8"></div>
                    </header>

                    <main className="flex-1 overflow-y-auto p-5 pb-24 no-scrollbar bg-slate-50">
                        {appMode === 'admin' && (
                            <div className="space-y-4 animate-in">
                                <h2 className="text-xl font-black">All Sellers ({allSellers.length})</h2>
                                {allSellers.map(s => (
                                    <div key={s.id} className="bg-white p-4 rounded-3xl border shadow-sm">
                                        <div className="flex justify-between items-start mb-2">
                                            <p className="font-black italic text-indigo-600">@{s.shopName}</p>
                                            <button onClick={() => db.collection('artifacts').doc(appId).collection('public').doc('data').collection('sellers').doc(s.uid).delete()} className="text-red-500"><Icon name="trash-2" size={16}/></button>
                                        </div>
                                        <p className="text-[10px] font-bold text-zinc-400">PAN: {s.pan}</p>
                                        <p className="text-[10px] font-bold text-zinc-400">BANK: {s.acc} / {s.ifsc}</p>
                                    </div>
                                ))}
                            </div>
                        )}

                        {appMode === 'seller' && !sellerProfile && (
                            <div className="bg-white p-8 rounded-[40px] border shadow-sm mt-5 animate-in">
                                <h2 className="text-xl font-black mb-6 text-center">Business Registration</h2>
                                <form className="space-y-4" onSubmit={async (e) => {
                                    e.preventDefault();
                                    const fd = new FormData(e.target);
                                    await db.collection('artifacts').doc(appId).collection('public').doc('data').collection('sellers').doc(user.uid).set({
                                        shopName: fd.get('shop'), pan: fd.get('pan'), acc: fd.get('acc'), ifsc: fd.get('ifsc'), uid: user.uid, joinedAt: new Date().toISOString()
                                    });
                                }}>
                                    <input name="shop" required className="w-full bg-slate-50 p-4 rounded-2xl outline-none border focus:border-indigo-300 font-bold" placeholder="Shop Name" />
                                    <input name="pan" required className="w-full bg-slate-50 p-4 rounded-2xl outline-none uppercase border focus:border-indigo-300 font-bold" placeholder="Indian PAN Card" />
                                    <input name="acc" required className="w-full bg-slate-50 p-4 rounded-2xl outline-none border focus:border-indigo-300 font-bold" placeholder="Account Number" />
                                    <input name="ifsc" required className="w-full bg-slate-50 p-4 rounded-2xl outline-none uppercase border focus:border-indigo-300 font-bold" placeholder="IFSC Code" />
                                    <button className="w-full bg-indigo-600 text-white py-4 rounded-2xl font-black uppercase text-xs">Verify & Launch</button>
                                </form>
                            </div>
                        )}

                        {appMode === 'seller' && sellerProfile && (
                            <div className="mt-5 p-10 bg-zinc-950 text-white rounded-[40px] text-center shadow-2xl animate-in">
                                <div className="w-16 h-16 bg-white/10 rounded-2xl flex items-center justify-center mx-auto mb-4"><Icon name="store" size={32} className="text-indigo-400"/></div>
                                <h2 className="text-2xl font-black italic leading-tight mb-1">@{sellerProfile.shopName}</h2>
                                <p className="text-[10px] font-black uppercase tracking-widest opacity-40 mb-10">Verified Seller Hub</p>
                                <button className="w-full bg-white text-black py-4 rounded-2xl font-black uppercase text-xs shadow-xl active:scale-95 transition-transform">New Inventory Drop</button>
                            </div>
                        )}

                        {appMode === 'buyer' && (
                             <div className="space-y-4 animate-in">
                                <div className="p-10 bg-emerald-50 rounded-[40px] text-center border border-emerald-100">
                                    <Icon name="shopping-bag" size={40} className="mx-auto mb-4 text-emerald-600"/>
                                    <h2 className="text-xl font-black uppercase text-emerald-900 tracking-tight">The Marketplace</h2>
                                    <p className="text-[10px] font-bold uppercase opacity-60">Auth Secured</p>
                                </div>
                                <div className="p-12 bg-white rounded-[40px] border border-dashed border-zinc-200 text-center">
                                    <p className="text-xs text-zinc-300 font-black uppercase tracking-[0.2em] italic">Waiting for fresh drops...</p>
                                </div>
                             </div>
                        )}
                    </main>

                    <nav className="fixed bottom-0 left-0 right-0 max-w-md mx-auto h-20 bg-white border-t flex items-center justify-around z-40">
                        <button onClick={() => setActiveTab('feed')} className={`p-3 ${activeTab === 'feed' ? 'text-zinc-900' : 'text-zinc-300'}`}><Icon name="package" size={24}/></button>
                        <button onClick={() => setActiveTab('chats')} className={`p-3 ${activeTab === 'chats' ? 'text-zinc-900' : 'text-zinc-300'}`}><Icon name="message-square" size={24}/></button>
                        <button onClick={() => setActiveTab('profile')} className={`p-3 ${activeTab === 'profile' ? 'text-zinc-900' : 'text-zinc-300'}`}><Icon name="user" size={24}/></button>
                    </nav>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>